# Bank Cards REST API

RESTful сервис для управления банковскими картами с JWT аутентификацией и ролевым доступом (ADMIN/USER).

## Архитектура

Монолитное приложение с разделением на уровни доступа:

**Публичный API** — регистрация и аутентификация (`/auth/**`)  
**Закрытый API (USER)** — управление своими картами, переводы, баланс (`/user/**`)  
**Административный API (ADMIN)** — управление пользователями и всеми картами (`/admin/**`)

## Ключевые возможности

**Для пользователей:**
Создание банковских карт — номер генерируется автоматически  
Просмотр своих карт — пагинация и поиск по номеру  
Переводы между своими картами — безопасные транзакции  
Блокировка/активация карт — самостоятельное управление статусом  
Пополнение баланса — добавление средств на карту

**Для администраторов:**
Управление пользователями — просмотр, изменение ролей, удаление  
Полный контроль над картами — создание, блокировка, активация, удаление  
Просмотр всех карт в системе — полная видимость

## Особенности реализации

**JWT аутентификация** — безопасный доступ к API  
**Ролевая модель** — разграничение прав USER/ADMIN  
**Шифрование данных** — номера карт хранятся в зашифрованном виде (AES)  
**Маскирование номеров** — в ответах API отображается только маска (`**** **** **** 1234`)  
**Валидация транзакций** — проверка достаточности средств и статуса карты  
**Централизованная обработка ошибок** — единый формат ответов об ошибках  
**Миграции БД через Liquibase** — версионирование структуры базы данных  

## Тестирование переводов

Для тестирования переводов в системе предустановлены тестовые данные:

**Пользователь:** tester / password123  
**Карта 1:** баланс 1000.00  
**Карта 2:** баланс 500.00  

Эти данные добавляются автоматически через Liquibase при первом запуске.

## Технический стек

| Компонент | Технологии |
|-----------|------------|
| **Backend** | Java 17, Spring Boot, Spring Security, Spring Data JPA |
| **База данных** | PostgreSQL |
| **Сборка** | Maven |
| **Миграции** | Liquibase |
| **Тестирование** | JUnit 5, Mockito |
| **Контейнеризация** | Docker, Docker Compose |
| **Документация** | Swagger UI (OpenAPI 3.0) |
| **Безопасность** | JWT, BCrypt, AES |
| **Утилиты** | Lombok |

## Системные требования

Java 17+  
Docker и Docker Compose (для запуска в контейнерах)  
Maven 3.8+ (для сборки из исходного кода)  
PostgreSQL 14+ (если запуск без Docker)  

## Запуск проекта c Docker Compose

**Клонировать репозиторий:**  
```bash
git clone https://github.com/Nastia-N/bank-cards.git  
cd bank-cards
```

**Запустить контейнеры:**  
```bash
docker-compose up -d
```

Проверить работу сервиса:  
Основной сервис: http://localhost:8080/api  
Swagger UI (документация API): http://localhost:8080/api/swagger-ui/index.html  
OpenAPI JSON: http://localhost:8080/api/api-docs  

**Остановить контейнеры:**  
```bash
docker-compose down
```

## Сборка и запуск без Docker

**Установите PostgreSQL и создайте базу данных:**  
```sql   
CREATE DATABASE bank_cards_db;
```

**Настройте подключение в src/main/resources/application.yml** (при необходимости)

**Соберите проект:**  
```bash
mvn clean package
```

**Запустите приложение:**  
```bash
java -jar target/Bank_REST-1.0.0.jar
```
Учетные данные для входа:  
**Администратор** (предустановлен через Liquibase):  
Логин: admin  
Пароль: admin123  
**Пользователь** (создать через регистрацию):  
POST /api/auth/register  

## Миграции БД (Liquibase)

**Миграции автоматически применяются при запуске приложения:**  
| Компонент | Описание |
|-----------|----------|
| `001-create-users-table.yaml` | Создание таблицы пользователей |
| `002-create-cards-table.yaml` | Создание таблицы карт |
| `003-create-transfers-table.yaml` | Создание таблицы переводов |
| `004-insert-admin-user.yaml` | Добавление администратора |



