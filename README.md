# Bank Cards REST API

RESTful сервис для управления банковскими картами с JWT аутентификацией и ролевым доступом (ADMIN/USER).

## Архитектура

Монолитное приложение с разделением на уровни доступа:

**Публичный API** — регистрация и аутентификация (`/auth/**`)  
**Закрытый API (USER)** — управление своими картами, переводы, баланс (`/user/**`)  
**Административный API (ADMIN)** — управление пользователями и всеми картами (`/admin/**`)

## Ключевые возможности

**Для пользователей:**
Создание банковских карт — номер генерируется автоматически  
Просмотр своих карт — пагинация и поиск по номеру  
Переводы между своими картами — безопасные транзакции  
Блокировка/активация карт — самостоятельное управление статусом  
Пополнение баланса — добавление средств на карту

**Для администраторов:**
Управление пользователями — просмотр, изменение ролей, удаление  
Полный контроль над картами — создание, блокировка, активация, удаление  
Просмотр всех карт в системе — полная видимость

## Особенности реализации

**JWT аутентификация** — безопасный доступ к API  
**Ролевая модель** — разграничение прав USER/ADMIN  
**Шифрование данных** — номера карт хранятся в зашифрованном виде (AES)  
**Маскирование номеров** — в ответах API отображается только маска (`**** **** **** 1234`)  
**Валидация транзакций** — проверка достаточности средств и статуса карты  
**Централизованная обработка ошибок** — единый формат ответов об ошибках  
**Миграции БД через Liquibase** — версионирование структуры базы данных  

## Технический стек

**Backend:** Java 17, Spring Boot, Spring Security, Spring Data JPA  
**База данных:** PostgreSQL  
**Сборка:** Maven  
**Миграции:** Liquibase  
**Тестирование:** JUnit 5, Mockito  
**Контейнеризация:** Docker, Docker Compose  
**Документация:** Swagger UI (OpenAPI 3.0)  
**Безопасность:** JWT, BCrypt, AES  
**Утилиты:** Lombok

## Системные требования

Java 17+  
Docker и Docker Compose (для запуска в контейнерах)  
Maven 3.8+ (для сборки из исходного кода)  
PostgreSQL 14+ (если запуск без Docker)  

## Запуск проекта c Docker Compose

**Клонировать репозиторий:**  
git clone https://github.com/Nastia-N/bank-cards.git  
cd bank-cards

**Запустить контейнеры:**  
docker-compose up -d  

Проверить работу сервиса:  
Основной сервис: http://localhost:8080/api  
Swagger UI (документация API): http://localhost:8080/api/swagger-ui/index.html  
OpenAPI JSON: http://localhost:8080/api/api-docs  

**Остановить контейнеры:**  
docker-compose down

## Сборка и запуск без Docker

**Установите PostgreSQL и создайте базу данных:**  
CREATE DATABASE bank_cards_db;

**Настройте подключение в src/main/resources/application.yml** (при необходимости)

**Соберите проект:**  
mvn clean package

**Запустите приложение:**  
java -jar target/Bank_REST-1.0.0.jar  
Учетные данные для входа:  
**Администратор** (предустановлен через Liquibase):  
Логин: admin  
Пароль: admin123  
**Пользователь** (создать через регистрацию):  
POST /api/auth/register  

## Миграции БД (Liquibase)

**Миграции автоматически применяются при запуске приложения:**  
001-create-users-table.yaml — создание таблицы пользователей  
002-create-cards-table.yaml — создание таблицы карт  
003-create-transfers-table.yaml — создание таблицы переводов  
004-insert-admin-user.yaml — добавление администратора
